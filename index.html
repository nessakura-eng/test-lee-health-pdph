<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lee County PDPH Dashboard</title>

<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet/dist/leaflet.css"
/>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet.heat/dist/leaflet-heat.js"></script>

<style>
  body { margin:0; padding:0; }
  #map { height:100vh; width:100%; }
</style>
</head>

<body>

<div id="map"></div>

<script>

// ===============================
// MAP INITIALIZATION
// ===============================
const map = L.map('map').setView([26.6406, -81.8723], 10);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap contributors'
}).addTo(map);

// ===============================
// CREATE SEPARATE PANES
// ===============================
map.createPane('heatPane');
map.getPane('heatPane').style.zIndex = 400;

map.createPane('zipPane');
map.getPane('zipPane').style.zIndex = 650;   // Above heatmap
map.getPane('zipPane').style.pointerEvents = 'auto';

// ===============================
// HEATMAP LAYER (KEEP YOUR DATA SOURCE)
// ===============================
const heatLayer = L.heatLayer([], {
    radius: 25,
    blur: 15,
    maxZoom: 12,
    pane: 'heatPane'
}).addTo(map);

// ===============================
// ZIP CODE BOUNDARIES
// Replace this URL with your official GIS GeoJSON export
// ===============================
fetch('lee_county_zipcodes.geojson')
.then(res => res.json())
.then(data => {

    function defaultStyle() {
        return {
            color: "#000000",
            weight: 2.5,
            opacity: 0.9,
            fillOpacity: 0.05
        };
    }

    function highlightStyle() {
        return {
            color: "#FF0000",
            weight: 4,
            opacity: 1,
            fillOpacity: 0.1
        };
    }

    function onEachFeature(feature, layer) {

        layer.on({
            mouseover: function(e) {
                e.target.setStyle(highlightStyle());
                e.target.bringToFront();
            },
            mouseout: function(e) {
                zipLayer.resetStyle(e.target);
            },
            click: function(e) {
                map.fitBounds(e.target.getBounds());
            }
        });

        if (feature.properties && feature.properties.ZIP) {
            layer.bindTooltip("ZIP: " + feature.properties.ZIP, {
                permanent: false,
                direction: "center",
                className: "zip-label"
            });
        }
    }

    window.zipLayer = L.geoJSON(data, {
        style: defaultStyle,
        pane: 'zipPane',
        onEachFeature: onEachFeature
    }).addTo(map);

});

// ===============================
// DISPLAY MODE CONTROLS (IF YOU HAVE THEM)
// Only adjusting boundary opacity dynamically
// ===============================
function setDisplayMode(mode) {

    if (!window.zipLayer) return;

    if (mode === "heat") {
        zipLayer.setStyle({
            fillOpacity: 0.02,
            weight: 2
        });
    }

    if (mode === "boundary") {
        zipLayer.setStyle({
            fillOpacity: 0.15,
            weight: 3
        });
    }

}

// Example toggle (optional if already exists)
window.setDisplayMode = setDisplayMode;

</script>

</body>
</html>
